<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Bootstrap demo</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-LN+7fdVzj6u52u30Kp6M/trliBMCMKTyK833zpbD+pXdCLuTusPj697FH4R/5mcr" crossorigin="anonymous">
</head>

<body>
    <div class="container">
        <h1>Калькулятор суммы оффера</h1>
        <div class="row">
            <div class="col">
                <div class="input-group mb-3">
                    <input id="gross" type="text" class="form-control" placeholder="Заработная плата gross"
                        aria-label="Заработная плата gross" aria-describedby="basic-addon2">
                    <div class="input-group-append">
                        <span class="input-group-text" id="basic-addon2">₽</span>
                    </div>
                </div>
            </div>
        </div>
        <div class="row">


            <table class="table">
                <thead>
                    <tr>
                        <th scope="col">Месяц</th>
                        <th scope="col">Совокупный доход в месяц, Gross</th>
                        <th scope="col">Налогооблагаемая база</th>
                        <th scope="col">Совокупный доход в месяц, net</th>
                        <th scope="col">НДФЛ</th>
                        <th scope="col">Ставка</th>
                    </tr>
                </thead>
                <tbody id="tableBody">

                </tbody>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/decimal.js/10.4.3/decimal.min.js"></script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-ndDqU0Gzau9qJ1lfW4pNLlhNTkCfHzAVBReH9diLvGRem5+R9g2FzA8ZGN954O5Q"
        crossorigin="anonymous"></script>

    <script>
        Decimal.set({ precision: 20, rounding: 0, minE: -3 });
        Decimal.set({ minE: -3 });

        var gross = document.getElementById('gross');

        const arr = ['Январь', 'Февраль', 'Март', 'Апрель', 'Май', 'Июнь',
            'Июль', 'Август', 'Сентябрь', 'Октябрь', 'Ноябрь', 'Декабрь'];
        var tableBody = document.getElementById('tableBody');

        gross.addEventListener("change", (event) => {

            try {
                var grossAmount = new Decimal(event.target.value);

                var oldnBase = Decimal(0);
                var nBase = Decimal(0);

                tableBody.replaceChildren();

                var grossSum = Decimal(0);
                var netSum = Decimal(0);
                for (let i = 0; i < arr.length; i++) {
                    const row = document.createElement("tr");
                    // Create and append cells for each data point
                    const month = document.createElement("td");
                    month.textContent = arr[i];
                    row.appendChild(month);

                    grossVal = grossAmount;
                    const grossTd = document.createElement("td");
                    grossTd.textContent = grossVal.toString();
                    row.appendChild(grossTd);


                    grossSum = grossSum.plus(grossVal);

                    nBase = nBase.plus(grossVal);

                    const nbaseTd = document.createElement("td");
                    nbaseTd.textContent = nBase.toString();
                    row.appendChild(nbaseTd);

                    var st = new Decimal('0.00')
                    var ndfl = new Decimal(0)
                    if (nBase.lte(new Decimal(2_400_000))) {
                        st = new Decimal('0.13')
                    } else if (nBase.lte(new Decimal(5_000_000))) {
                        st = new Decimal('0.15')
                    } else if (nBase.lte(new Decimal(20_000_000))) {
                        st = new Decimal('0.18')
                    } else if (nBase.lte(new Decimal(50_000_000))) {
                        st = new Decimal('0.20')
                    } else {
                        st = new Decimal('0.22')
                    }
                    ndfl = grossVal.mul(st)

                    var net = grossVal.minus(ndfl)

                    netSum = netSum.plus(net)

                    const netTd = document.createElement("td");
                    netTd.textContent = net.toString();
                    row.appendChild(netTd);


                    const ndflTd = document.createElement("td");
                    ndflTd.textContent = ndfl.toString();
                    row.appendChild(ndflTd);


                    const stTd = document.createElement("td");
                    stTd.textContent = st.mul('100').toString();
                    row.appendChild(stTd);

                    tableBody.appendChild(row);

                }

                const result = document.createElement("tr");
                result.className = 'table-info';

                const resultTd1 = document.createElement("td");
                resultTd1.textContent = "Итого";
                result.appendChild(resultTd1);

                const resultTd2 = document.createElement("td");
                resultTd2.textContent = grossSum.toString();
                result.appendChild(resultTd2);

                const resultTd3 = document.createElement("td");
                resultTd3.textContent = '';
                result.appendChild(resultTd3);

                const resultTd4 = document.createElement("td");
                resultTd4.textContent = netSum.toString()
                result.appendChild(resultTd4);
                const resultTd5 = document.createElement("td");
                resultTd5.textContent = '';
                result.appendChild(resultTd5);

                const resultTd6 = document.createElement("td");
                resultTd6.textContent = '';
                result.appendChild(resultTd6);

                tableBody.appendChild(result);

            } catch (error) {
                alert("Неправильное значение заработной платы" + toString(error));
            } finally {
            }
        });

    </script>
</body>

</html>